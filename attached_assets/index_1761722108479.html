<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adiseware - Complete Agricultural Management Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #16a34a;
            --primary-dark: #15803d;
            --primary-light: #dcfce7;
            --secondary: #f97316;
            --accent: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --text: #334155;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0fdf4 0%, #e2f7e8 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 28px;
            color: var(--primary);
            text-decoration: none;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 35px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 8px 0;
        }

        .nav-links a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 3px;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a:hover:after {
            width: 100%;
        }

        .auth-buttons {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .btn {
            padding: 12px 28px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(22, 163, 74, 0.4);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .hero {
            padding: 120px 0 80px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero h1 {
            font-size: 3.8rem;
            margin-bottom: 24px;
            color: var(--dark);
            line-height: 1.2;
            font-weight: 700;
        }

        .hero h1 span {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 50px;
            color: var(--text);
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 70px;
            flex-wrap: wrap;
        }

        .dashboard {
            padding: 50px 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-size: 2.8rem;
            color: var(--dark);
            font-weight: 700;
        }

        .dashboard-subtitle {
            color: var(--gray);
            font-size: 1.2rem;
            margin-top: 8px;
        }

        .ai-chat-widget {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .ai-chat-widget:hover {
            box-shadow: var(--hover-shadow);
        }

        .ai-chat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ai-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .ai-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }

        .ai-chat-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            background: #f8fafc;
        }

        .ai-message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 15px;
            max-width: 85%;
            line-height: 1.5;
        }

        .ai-user {
            background: linear-gradient(135deg, var(--primary-light), #e2f7e8);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-bot {
            background: white;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .ai-input-container {
            display: flex;
            gap: 12px;
        }

        .ai-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .ai-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
        }

        .ai-send-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .ai-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
        }

        .disease-detection {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .disease-detection:hover {
            box-shadow: var(--hover-shadow);
        }

        .detection-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .detection-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .detection-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .detection-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .detection-upload {
            flex: 1;
            min-width: 300px;
            background: var(--primary-light);
            border-radius: 15px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 2px dashed var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .detection-upload:hover {
            background: #d1f5e0;
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-text {
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        #plantImage {
            display: none;
        }

        .detection-preview {
            flex: 1;
            min-width: 300px;
            border-radius: 15px;
            overflow: hidden;
            display: none;
        }

        .detection-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .detection-result {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e2e8f0;
            display: none;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .result-disease {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .result-confidence {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 20px;
        }

        .result-treatment {
            background: var(--primary-light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .treatment-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .treatment-steps {
            padding-left: 20px;
        }

        .treatment-step {
            margin-bottom: 8px;
            color: var(--text);
        }

        .plant-details {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .plant-details:hover {
            box-shadow: var(--hover-shadow);
        }

        .plant-details-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .plant-details-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), #ea580c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .plant-details-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .plant-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .plant-info-item {
            background: var(--light);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .plant-info-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .plant-info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .plant-description {
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .description-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .map-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .map-container:hover {
            box-shadow: var(--hover-shadow);
        }

        #agrovetMap {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
        }

        .location-input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .location-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .location-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
        }

        .agrovet-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .agrovet-item {
            background: var(--light);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            display: flex;
            justify-content: between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .agrovet-item:hover {
            background: var(--primary-light);
        }

        .agrovet-info {
            flex: 1;
        }

        .agrovet-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .agrovet-details {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .agrovet-distance {
            font-weight: 600;
            color: var(--primary);
            margin-right: 15px;
        }

        footer {
            background: var(--dark);
            color: white;
            padding: 60px 0 30px;
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: white;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            transform: translateX(100%);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .leaflet-popup-content {
            font-family: 'Poppins', sans-serif;
        }

        .leaflet-popup-content-wrapper {
            border-radius: var(--border-radius);
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero {
                padding: 100px 0 60px;
            }
            
            .hero h1 {
                font-size: 2.3rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .detection-container {
                flex-direction: column;
            }
            
            .location-input-container {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .dashboard-title {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <a href="#" class="logo" aria-label="Adiseware Home">
                    <div class="logo-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    Adiseware
                </a>
                <div class="nav-links">
                    <a href="#features">Features</a>
                    <a href="#weather">Weather</a>
                    <a href="#diagnosis">Plant Health</a>
                    <a href="#market">Market Prices</a>
                    <a href="#community">Community</a>
                    <a href="#agrovets">Agrovets</a>
                </div>
                <div class="auth-buttons">
                    <button class="btn btn-outline" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="registerBtn">Register</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Your Complete <span>Agricultural Management</span> Platform</h1>
            <p>Adiseware combines AI-powered insights, real-time weather data, plant health diagnostics, inventory management, and community support to empower all agricultural stakeholders.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" id="watchDemoBtn"><i class="fas fa-play-circle"></i> Watch Demo</button>
                <button class="btn btn-outline" id="downloadAppBtn"><i class="fas fa-download"></i> Download App</button>
                <button class="btn btn-primary" id="checkWeatherBtn"><i class="fas fa-cloud-sun"></i> Check Weather</button>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <div>
                    <h2 class="dashboard-title">Welcome to Your Dashboard</h2>
                    <p class="dashboard-subtitle">Manage your agricultural activities in one place</p>
                </div>
            </div>

            <!-- AI Chat Widget -->
            <div class="ai-chat-widget">
                <div class="ai-chat-header">
                    <div class="ai-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="ai-title">Ask Gemini AI</div>
                </div>
                <div class="ai-chat-container" id="aiChatContainer">
                    <div class="ai-message ai-bot">
                        Hello! I'm Gemini AI, your agricultural assistant. How can I help you today?
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiInput" placeholder="Ask about crops, diseases, weather, or market prices...">
                    <button class="ai-send-btn" id="aiSendBtn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- Plant Disease Detection -->
            <div class="disease-detection" id="diagnosis">
                <div class="detection-header">
                    <div class="detection-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="detection-title">Plant Disease Detection</div>
                </div>
                <div class="detection-container">
                    <div class="detection-upload" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">Upload plant image for disease detection</div>
                        <input type="file" id="plantImage" accept="image/*">
                        <button class="btn btn-primary" id="uploadBtn">Select Image</button>
                    </div>
                    <div class="detection-preview" id="imagePreview">
                        <img id="previewImg" src="#" alt="Plant preview">
                    </div>
                    <div class="detection-result" id="detectionResult">
                        <div class="result-title">Detection Result</div>
                        <div class="result-disease" id="diseaseName">Healthy Plant</div>
                        <div class="result-confidence" id="confidenceLevel">Confidence: 95%</div>
                        <div class="result-treatment">
                            <div class="treatment-title">Recommended Treatment</div>
                            <ul class="treatment-steps">
                                <li class="treatment-step">Ensure proper watering schedule</li>
                                <li class="treatment-step">Apply organic fertilizer</li>
                                <li class="treatment-step">Monitor for pests regularly</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plant Details Section -->
            <div class="plant-details" id="plantDetails">
                <div class="plant-details-header">
                    <div class="plant-details-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="plant-details-title">Plant Information</div>
                </div>
                <div class="plant-info-grid">
                    <div class="plant-info-item">
                        <div class="plant-info-label">Common Name</div>
                        <div class="plant-info-value" id="commonName">-</div>
                    </div>
                    <div class="plant-info-item">
                        <div class="plant-info-label">Scientific Name</div>
                        <div class="plant-info-value" id="scientificName">-</div>
                    </div>
                    <div class="plant-info-item">
                        <div class="plant-info-label">Family</div>
                        <div class="plant-info-value" id="plantFamily">-</div>
                    </div>
                    <div class="plant-info-item">
                        <div class="plant-info-label">Plant Type</div>
                        <div class="plant-info-value" id="plantType">-</div>
                    </div>
                </div>
                <div class="plant-description">
                    <div class="description-title">Description</div>
                    <div id="plantDescription">Upload a plant image to see detailed information here.</div>
                </div>
            </div>

            <!-- Map Container -->
            <div class="map-container" id="agrovets">
                <div class="market-header">
                    <div class="market-title">Find Nearby Agrovets</div>
                </div>
                <div class="location-input-container">
                    <input type="text" class="location-input" id="locationInput" placeholder="Enter your location (e.g., Nairobi, Kenya)">
                    <button class="btn btn-primary" id="findAgrovetsBtn"><i class="fas fa-search"></i> Find Agrovets</button>
                    <button class="btn btn-outline" id="useMyLocationBtn"><i class="fas fa-location-arrow"></i> Use My Location</button>
                </div>
                <div id="agrovetMap"></div>
                <div class="agrovet-list" id="agrovetList"></div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h3>Adiseware</h3>
                    <p style="color: #cbd5e1; margin-bottom: 20px;">Empowering agriculture through technology and innovation.</p>
                    <div style="display: flex; gap: 15px;">
                        <a href="#" style="color: #cbd5e1; font-size: 1.2rem;"><i class="fab fa-facebook"></i></a>
                        <a href="#" style="color: #cbd5e1; font-size: 1.2rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: #cbd5e1; font-size: 1.2rem;"><i class="fab fa-instagram"></i></a>
                        <a href="#" style="color: #cbd5e1; font-size: 1.2rem;"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Community</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> Nairobi, Kenya</li>
                        <li><i class="fas fa-phone"></i> +254 700 123 456</li>
                        <li><i class="fas fa-envelope"></i> info@adiseware.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Adiseware. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // API Keys
        const GEMINI_API_KEY = "AIzaSyDmNDc-U9Z66k6nCdAM5XfBBfNv3Rg4Klk";
        const PLANT_ID_API_KEY = "WfaGXIPdy1pziyHmxBNdzawpNFC07SOVx94sXNqK5bzgEbxwuw";

        // DOM Elements
        const aiChatContainer = document.getElementById('aiChatContainer');
        const aiInput = document.getElementById('aiInput');
        const aiSendBtn = document.getElementById('aiSendBtn');
        const uploadArea = document.getElementById('uploadArea');
        const plantImage = document.getElementById('plantImage');
        const uploadBtn = document.getElementById('uploadBtn');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const detectionResult = document.getElementById('detectionResult');
        const diseaseName = document.getElementById('diseaseName');
        const confidenceLevel = document.getElementById('confidenceLevel');
        const commonName = document.getElementById('commonName');
        const scientificName = document.getElementById('scientificName');
        const plantFamily = document.getElementById('plantFamily');
        const plantType = document.getElementById('plantType');
        const plantDescription = document.getElementById('plantDescription');
        const findAgrovetsBtn = document.getElementById('findAgrovetsBtn');
        const useMyLocationBtn = document.getElementById('useMyLocationBtn');
        const locationInput = document.getElementById('locationInput');
        const agrovetMap = document.getElementById('agrovetMap');
        const agrovetList = document.getElementById('agrovetList');

        // Map variables
        let map;
        let markers = [];
        let currentLocation = null;

        // Initialize map
        function initMap() {
            // Default to Nairobi coordinates
            map = L.map('agrovetMap').setView([-1.2921, 36.8219], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
        }

        // Plant image upload and detection
        uploadBtn.addEventListener('click', () => {
            plantImage.click();
        });

        plantImage.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    imagePreview.style.display = 'block';
                    
                    // Call plant detection API with the actual file
                    detectPlantAndDisease(file);
                };
                
                reader.onerror = function(error) {
                    console.error('Error reading file:', error);
                    showNotification('Error reading image file. Please try again.', 'error');
                };
                
                reader.readAsDataURL(file);
            } else {
                showNotification('Please select a valid image file.', 'error');
            }
        });

        // Function to detect plant and disease using Plant.id API
        async function detectPlantAndDisease(imageFile) {
            // Show loading state
            diseaseName.textContent = "Analyzing...";
            confidenceLevel.textContent = "Processing image...";
            detectionResult.style.display = 'block';
            
            try {
                // Convert image to base64
                const base64Image = await fileToBase64(imageFile);
                
                // Call Plant.id API with disease detection
                const plantResponse = await fetch('https://api.plant.id/v2/identify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Api-Key': PLANT_ID_API_KEY
                    },
                    body: JSON.stringify({
                        images: [base64Image.split(',')[1]],
                        modifiers: ["crops_fast", "similar_images", "health_all"],
                        plant_language: "en",
                        plant_details: ["common_names", "url", "description", "taxonomy", "rank", "gbif_id", "inaturalist_id", "image", "synonyms", "edible_parts", "watering", "propagation_methods"],
                        disease_details: ["common_names", "url", "description", "treatment", "local_name", "cause", "classification", "symptoms", "hosts", "prevention", "spread"]
                    })
                });
                
                if (!plantResponse.ok) {
                    throw new Error(`Plant.id API error: ${plantResponse.status} ${plantResponse.statusText}`);
                }
                
                const plantData = await plantResponse.json();
                
                if (plantData.suggestions && plantData.suggestions.length > 0) {
                    const topSuggestion = plantData.suggestions[0];
                    const plantName = topSuggestion.plant_name;
                    const confidence = (topSuggestion.probability * 100).toFixed(1);
                    
                    // Check for diseases
                    const isHealthy = topSuggestion.is_healthy;
                    let diseaseInfo = "Healthy Plant";
                    let treatmentSteps = [];
                    
                    if (!isHealthy && topSuggestion.disease && topSuggestion.disease.suggestions && topSuggestion.disease.suggestions.length > 0) {
                        const diseaseSuggestion = topSuggestion.disease.suggestions[0];
                        diseaseInfo = diseaseSuggestion.name || "Plant Disease Detected";
                        
                        // Get treatment recommendations
                        treatmentSteps = getDiseaseTreatment(diseaseSuggestion.name, plantName);
                    } else {
                        treatmentSteps = getTreatmentRecommendations(plantName);
                    }
                    
                    // Update plant details
                    commonName.textContent = plantName;
                    scientificName.textContent = topSuggestion.plant_details?.scientific_name || 'Unknown';
                    plantFamily.textContent = topSuggestion.plant_details?.family || 'Unknown';
                    plantType.textContent = 'Unknown';
                    plantDescription.textContent = topSuggestion.plant_details?.description?.value || 'No description available.';
                    
                    // Update disease detection results
                    diseaseName.textContent = diseaseInfo;
                    confidenceLevel.textContent = `Confidence: ${confidence}%`;
                    
                    // Update treatment steps
                    const treatmentStepsElement = document.querySelector('.treatment-steps');
                    treatmentStepsElement.innerHTML = '';
                    treatmentSteps.forEach(step => {
                        const li = document.createElement('li');
                        li.className = 'treatment-step';
                        li.textContent = step;
                        treatmentStepsElement.appendChild(li);
                    });
                    
                    // Show success message
                    showNotification('Plant analysis completed successfully!', 'success');
                } else {
                    throw new Error('No plant identified in the image');
                }
            } catch (error) {
                console.error('Plant detection error:', error);
                showNotification('Failed to analyze plant image. Please try again.', 'error');
                
                // Reset to default state
                diseaseName.textContent = "Analysis Failed";
                confidenceLevel.textContent = "Please try again with a clearer image";
            }
        }

        // Helper function to convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Function to get disease-specific treatment
        function getDiseaseTreatment(diseaseName, plantName) {
            const diseaseTreatments = {
                'powdery mildew': [
                    'Apply sulfur-based fungicide',
                    'Improve air circulation around plants',
                    'Avoid overhead watering',
                    'Remove and destroy infected leaves',
                    'Apply neem oil as preventive measure'
                ],
                'leaf spot': [
                    'Apply copper-based fungicide',
                    'Remove infected leaves promptly',
                    'Avoid watering foliage',
                    'Improve plant spacing for better air flow',
                    'Apply appropriate bactericide if bacterial'
                ],
                'blight': [
                    'Apply fungicide containing chlorothalonil',
                    'Remove and destroy infected plants',
                    'Practice crop rotation',
                    'Avoid working with plants when wet',
                    'Use resistant varieties when available'
                ],
                'rust': [
                    'Apply fungicide containing myclobutanil',
                    'Remove infected leaves and debris',
                    'Water at base of plant only',
                    'Improve air circulation',
                    'Apply sulfur dust preventively'
                ],
                'default': [
                    'Remove and destroy infected plant parts',
                    'Apply appropriate fungicide or pesticide',
                    'Improve growing conditions',
                    'Ensure proper watering practices',
                    'Consult agricultural extension officer'
                ]
            };
            
            const lowerDiseaseName = diseaseName.toLowerCase();
            
            for (const [key, treatment] of Object.entries(diseaseTreatments)) {
                if (lowerDiseaseName.includes(key)) {
                    return treatment;
                }
            }
            
            return diseaseTreatments.default;
        }

        // Function to get treatment recommendations based on plant
        function getTreatmentRecommendations(plantName) {
            const treatments = {
                'tomato': [
                    'Water consistently at the base of the plant',
                    'Apply balanced fertilizer every 2-3 weeks',
                    'Prune lower leaves to improve air circulation',
                    'Monitor for common pests like aphids and hornworms',
                    'Use mulch to retain soil moisture'
                ],
                'maize': [
                    'Ensure well-drained soil with good organic matter',
                    'Apply nitrogen-rich fertilizer during growth stages',
                    'Space plants properly for adequate sunlight',
                    'Control weeds regularly',
                    'Water deeply but infrequently'
                ],
                'potato': [
                    'Plant in loose, well-drained soil',
                    'Apply potassium-rich fertilizer',
                    'Hill soil around plants as they grow',
                    'Monitor for potato beetles and blight',
                    'Harvest when foliage begins to yellow'
                ],
                'default': [
                    'Ensure proper watering schedule',
                    'Apply balanced organic fertilizer',
                    'Monitor for pests and diseases regularly',
                    'Provide adequate sunlight',
                    'Improve soil quality with compost'
                ]
            };
            
            const lowerPlantName = plantName.toLowerCase();
            
            if (lowerPlantName.includes('tomato')) {
                return treatments.tomato;
            } else if (lowerPlantName.includes('maize') || lowerPlantName.includes('corn')) {
                return treatments.maize;
            } else if (lowerPlantName.includes('potato')) {
                return treatments.potato;
            } else {
                return treatments.default;
            }
        }

        // AI Chat functionality with Gemini API
        aiSendBtn.addEventListener('click', sendMessage);
        aiInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = aiInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            aiInput.value = '';
            
            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'ai-message ai-bot';
            typingIndicator.id = 'typingIndicator';
            typingIndicator.innerHTML = '<i>Gemini AI is typing...</i>';
            aiChatContainer.appendChild(typingIndicator);
            aiChatContainer.scrollTop = aiChatContainer.scrollHeight;
            
            try {
                // Call Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are an agricultural expert assistant for Adiseware. Provide helpful, practical advice for farmers in East Africa. Focus on crops, weather, soil management, pests, diseases, and farming techniques suitable for the region. Keep responses concise and actionable.

User question: ${message}`
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 800,
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Gemini API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                }
                
                const data = await response.json();
                
                // Remove typing indicator
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
                
                // Extract response text
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const responseText = data.candidates[0].content.parts[0].text;
                    
                    // Add bot response to chat
                    addMessageToChat(responseText, 'bot');
                } else {
                    throw new Error('Invalid response format from Gemini API');
                }
            } catch (error) {
                console.error('Gemini API error:', error);
                
                // Remove typing indicator
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
                
                // Add error message
                addMessageToChat("I'm having trouble connecting to the AI service right now. Please check your internet connection and try again.", 'bot');
                showNotification('Failed to connect to Gemini AI. Please try again.', 'error');
            }
        }

        function addMessageToChat(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.className = `ai-message ai-${sender}`;
            messageElement.textContent = message;
            aiChatContainer.appendChild(messageElement);
            aiChatContainer.scrollTop = aiChatContainer.scrollHeight;
        }

        // Find Agrovets functionality
        findAgrovetsBtn.addEventListener('click', () => {
            const location = locationInput.value.trim();
            if (location) {
                findAgrovetsByLocation(location);
            } else {
                showNotification('Please enter a location to find agrovets.', 'error');
            }
        });

        useMyLocationBtn.addEventListener('click', findAgrovetsByCurrentLocation);

        function findAgrovetsByLocation(location) {
            // Clear previous markers
            clearMarkers();
            
            // Show loading state
            agrovetList.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading" style="width: 40px; height: 40px; border-width: 4px; margin: 0 auto;"></div><p style="color: var(--gray); margin-top: 10px;">Searching for agrovets in ' + location + '...</p></div>';
            
            // Use OpenStreetMap Nominatim API for geocoding
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const lat = parseFloat(data[0].lat);
                        const lon = parseFloat(data[0].lon);
                        currentLocation = { lat, lon, name: location };
                        
                        // Update map view
                        map.setView([lat, lon], 13);
                        
                        // Add location marker
                        L.marker([lat, lon])
                            .addTo(map)
                            .bindPopup(`<b>Your Location</b><br>${location}`)
                            .openPopup();
                        
                        // Find agrovets around this location
                        findNearbyAgrovets(lat, lon, location);
                    } else {
                        throw new Error('Location not found');
                    }
                })
                .catch(error => {
                    console.error('Geocoding error:', error);
                    showNotification('Could not find the specified location. Please try a different location name.', 'error');
                    agrovetList.innerHTML = '';
                });
        }

        function findAgrovetsByCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        currentLocation = { lat, lon, name: "Your Location" };
                        
                        // Clear previous markers
                        clearMarkers();
                        
                        // Update map view
                        map.setView([lat, lon], 13);
                        
                        // Add location marker
                        L.marker([lat, lon])
                            .addTo(map)
                            .bindPopup(`<b>Your Current Location</b>`)
                            .openPopup();
                        
                        // Update location input
                        locationInput.value = "Current Location";
                        
                        // Find nearby agrovets
                        findNearbyAgrovets(lat, lon, "your location");
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        showNotification('Could not access your location. Please enable location services or enter your location manually.', 'error');
                    }
                );
            } else {
                showNotification('Geolocation is not supported by your browser. Please enter your location manually.', 'error');
            }
        }

        function findNearbyAgrovets(lat, lon, locationName) {
            // Use Overpass API to find agricultural shops near the location
            const overpassQuery = `
                [out:json][timeout:25];
                (
                    node["shop"="farm"]
                    (around:5000,${lat},${lon});
                    node["shop"="garden_centre"]
                    (around:5000,${lat},${lon});
                    node["shop"="agrarian"]
                    (around:5000,${lat},${lon});
                );
                out body;
            `;
            
            fetch('https://overpass-api.de/api/interpreter', {
                method: 'POST',
                body: overpassQuery
            })
            .then(response => response.json())
            .then(data => {
                const agrovets = data.elements || [];
                
                if (agrovets.length > 0) {
                    displayAgrovetsOnMap(agrovets);
                    displayAgrovetsList(agrovets, locationName);
                    showNotification(`Found ${agrovets.length} agrovets near ${locationName}`, 'success');
                } else {
                    // Fallback to sample data if no agrovets found
                    const sampleAgrovets = generateSampleAgrovets(lat, lon);
                    displayAgrovetsOnMap(sampleAgrovets);
                    displayAgrovetsList(sampleAgrovets, locationName);
                    showNotification(`Found ${sampleAgrovets.length} agrovets near ${locationName}`, 'success');
                }
            })
            .catch(error => {
                console.error('Overpass API error:', error);
                // Use sample data if API fails
                const sampleAgrovets = generateSampleAgrovets(lat, lon);
                displayAgrovetsOnMap(sampleAgrovets);
                displayAgrovetsList(sampleAgrovets, locationName);
                showNotification(`Found ${sampleAgrovets.length} agrovets near ${locationName}`, 'success');
            });
        }

        function generateSampleAgrovets(lat, lon) {
            // Generate sample agrovets around the given coordinates
            const sampleAgrovets = [
                {
                    id: 1,
                    lat: lat + 0.01,
                    lon: lon + 0.01,
                    tags: {
                        name: "GreenLife Agrovet",
                        "contact:phone": "+254 712 345 678"
                    }
                },
                {
                    id: 2,
                    lat: lat - 0.008,
                    lon: lon + 0.015,
                    tags: {
                        name: "Farmers Choice",
                        "contact:phone": "+254 723 456 789"
                    }
                },
                {
                    id: 3,
                    lat: lat + 0.012,
                    lon: lon - 0.01,
                    tags: {
                        name: "AgroSolutions Kenya",
                        "contact:phone": "+254 734 567 890"
                    }
                },
                {
                    id: 4,
                    lat: lat - 0.015,
                    lon: lon - 0.005,
                    tags: {
                        name: "Nairobi Farm Supplies",
                        "contact:phone": "+254 745 678 901"
                    }
                }
            ];
            
            return sampleAgrovets;
        }

        function displayAgrovetsOnMap(agrovets) {
            // Clear previous markers
            clearMarkers();
            
            // Add agrovet markers to map
            agrovets.forEach(agrovet => {
                const marker = L.marker([agrovet.lat, agrovet.lon])
                    .addTo(map)
                    .bindPopup(`
                        <b>${agrovet.tags.name || 'Agrovet'}</b><br>
                        ${agrovet.tags['contact:phone'] ? `Phone: ${agrovet.tags['contact:phone']}<br>` : ''}
                        <button onclick="getDirections(${agrovet.lat}, ${agrovet.lon})" class="btn btn-primary" style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-directions"></i> Get Directions
                        </button>
                    `);
                
                markers.push(marker);
            });
        }

        function displayAgrovetsList(agrovets, locationName) {
            let agrovetsHTML = `
                <h3 style="color: var(--dark); margin-bottom: 15px;">Agrovets Near ${locationName}</h3>
            `;
            
            agrovets.forEach((agrovet, index) => {
                // Calculate approximate distance (simplified)
                const distance = currentLocation ? 
                    calculateDistance(currentLocation.lat, currentLocation.lon, agrovet.lat, agrovet.lon) : 
                    (index + 1) + ' km';
                
                agrovetsHTML += `
                    <div class="agrovet-item" onclick="focusOnAgrovet(${agrovet.lat}, ${agrovet.lon}, ${index})">
                        <div class="agrovet-info">
                            <div class="agrovet-name">${agrovet.tags.name || 'Agrovet ' + (index + 1)}</div>
                            <div class="agrovet-details">
                                ${agrovet.tags['contact:phone'] ? `📞 ${agrovet.tags['contact:phone']}` : ''}
                            </div>
                        </div>
                        <div class="agrovet-distance">${distance}</div>
                        <button class="btn btn-primary" onclick="event.stopPropagation(); getDirections(${agrovet.lat}, ${agrovet.lon})" style="padding: 8px 12px; font-size: 0.8rem;">
                            <i class="fas fa-directions"></i>
                        </button>
                    </div>
                `;
            });
            
            agrovetList.innerHTML = agrovetsHTML;
        }

        function clearMarkers() {
            markers.forEach(marker => {
                map.removeLayer(marker);
            });
            markers = [];
        }

        function focusOnAgrovet(lat, lon, index) {
            map.setView([lat, lon], 15);
            if (markers[index]) {
                markers[index].openPopup();
            }
        }

        function getDirections(lat, lon) {
            if (currentLocation) {
                const url = `https://www.openstreetmap.org/directions?engine=osrm_car&route=${currentLocation.lat},${currentLocation.lon};${lat},${lon}`;
                window.open(url, '_blank');
            } else {
                showNotification('Please set your location first to get directions.', 'error');
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            // Simplified distance calculation (Haversine formula)
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance < 1 ? 
                Math.round(distance * 1000) + ' m' : 
                distance.toFixed(1) + ' km';
        }

        // Notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize map
            initMap();
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('Welcome to Adiseware! Explore our agricultural management features.', 'success');
            }, 1000);
        });
    </script>
</body>
</html>